{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Country Participation in 2024 Summer Paris Olympics",
    "fontSize": 24,
    "fontWeight": "bold",
    "anchor": "middle",
    "offset": 20
  },
  "width": "container",
  "height": "container",
  "autosize": { "type": "fit", "contains": "padding" },
  "data": {
    "url": "https://raw.githubusercontent.com/J3rey/FIT3179-Data-Visualisation-HW-W9/refs/heads/main/symbols/ne_110m.topojson",
    "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
  },
  "projection": { "type": "naturalEarth1" },
  "params": [
    {
      "name": "showLabels",
      "value": true,
      "bind": { "input": "checkbox", "name": "Show top 5 couintries" }
    }
  ],
  "layer": [
    {
      "transform": [
        {
          "calculate": "'Data is not available in ' + datum.properties.NAME",
          "as": "note"
        }
      ],
      "mark": { "type": "geoshape", "fill": "lightgray", "stroke": "white" },
      "encoding": { "tooltip": { "field": "note" } }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/J3rey/FIT3179-Data-Visualisation-HW-W9/refs/heads/main/symbols/oceans.topojson",
        "format": { "type": "topojson", "feature": "oceans" }
      },
      "mark": { "type": "geoshape", "fill": "skyblue" }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/J3rey/FIT3179-Data-Visualisation-HW-W9/refs/heads/main/symbols/WorldMapWithGraticules.topojson",
        "format": { "type": "topojson", "feature": "ne_110m_graticules_30" }
      },
      "mark": { "type": "geoshape", "fill": null, "stroke": "lightgray" }
    },
    {
      "transform": [
        {
          "calculate": "datum.properties.NAME == 'United States of America' ? 'United States' : datum.properties.NAME == 'United Kingdom' ? 'Great Britain' : datum.properties.NAME == 'South Korea' ? 'Korea' : datum.properties.NAME == 'North Korea' ? 'DPR Korea' : datum.properties.NAME == 'Taiwan' ? 'Chinese Taipei' : datum.properties.NAME == 'Iran' ? 'IR Iran' : datum.properties.NAME == 'Turkey' ? 'TÃ¼rkiye' : datum.properties.NAME == 'Czech Republic' ? 'Czechia' : datum.properties.NAME == 'Russia' ? 'Russian Federation' : datum.properties.NAME == 'Republic of Moldova' ? 'Republic of Moldova' : datum.properties.NAME == 'Republic of the Congo' ? 'Congo' : datum.properties.NAME == 'Democratic Republic of the Congo' ? 'DRC' : datum.properties.NAME == 'Myanmar' ? 'Myanmar' : datum.properties.NAME == 'Vietnam' ? 'Viet Nam' : datum.properties.NAME == 'Bosnia and Herzegovina' ? 'Bosnia and Herzegovina' : datum.properties.NAME == 'North Macedonia' ? 'North Macedonia' : datum.properties.NAME == 'Eswatini' ? 'Swaziland' : datum.properties.NAME",
          "as": "country_lookup"
        },
        {
          "lookup": "country_lookup",
          "from": {
            "data": { "url": "../data/country_athlete_counts.csv" },
            "key": "Country",
            "fields": ["Number_of_Athletes"]
          },
          "default": 0
        },
        {
          "calculate": "datum.Number_of_Athletes != null ? +datum.Number_of_Athletes : 0",
          "as": "athlete_count"
        }
      ],
      "mark": { "type": "geoshape", "stroke": "white" },
      "encoding": {
        "color": {
          "field": "athlete_count",
          "type": "quantitative",
          "scale": {
            "type": "threshold",
            "domain": [1, 50, 100, 200, 400],
            "range": [
              "#f7fcf5",
              "#e5f5e0",
              "#c7e9c0",
              "#a1d99b",
              "#74c476",
              "#238b45"
            ],
            "zero": false
          },
          "legend": {
            "title": "Number of Athletes",
            "titleFontSize": 14,
            "titleFontWeight": "bold",
            "titleColor": "#2c3e50",
            "labelFontSize": 12,
            "labelColor": "#34495e",
            "orient": "right",
            "offset": 5,
            "cornerRadius": 5,
            "padding": 10,
            "strokeColor": "#bdc3c7",
            "fillColor": "rgba(255, 255, 255, 0.9)",
            "type": "gradient",
            "gradientLength": 140,
            "gradientThickness": 12,
            "format": "d",
            "values": [0, 50, 100, 200, 400],
            "labelExpr": "datum.value == 0 ? '0' : datum.value == 50 ? '1-49' : datum.value == 100 ? '50-99' : datum.value == 200 ? '100-199' : '400+'"
          }
        },
        "tooltip": [
          { "field": "properties.NAME", "type": "nominal", "title": "Country" },
          {
            "field": "athlete_count",
            "type": "quantitative",
            "title": "Participation",
            "format": "d"
          }
        ]
      }
    },
    {
      "data": {
        "values": [
          { "Country": "United States", "lon": -98, "lat": 39 },
          { "Country": "France", "lon": 2, "lat": 46 },
          { "Country": "Australia", "lon": 134, "lat": -25 },
          { "Country": "Germany", "lon": 10.5, "lat": 51 },
          { "Country": "Japan", "lon": 138, "lat": 36 }
        ]
      },
      "transform": [
        {
          "lookup": "Country",
          "from": {
            "data": { "url": "../data/country_athlete_counts.csv" },
            "key": "Country",
            "fields": ["Number_of_Athletes"]
          }
        },
        {
          "calculate": "toNumber(datum.Number_of_Athletes)",
          "as": "athlete_count"
        },
        {
          "window": [{ "op": "rank", "as": "rank" }],
          "sort": [{ "field": "athlete_count", "order": "descending" }]
        },
        { "filter": "datum.rank <= 5" },
        {
          "calculate": "format(datum.rank, '.0f') + '. ' + datum.Country + ' ' + datum.athlete_count",
          "as": "label"
        }
      ],
      "mark": {
        "type": "text",
        "font": "Trebuchet MS",
        "fontSize": 15,
        "fontWeight": "normal",
        "dy": -6,
        "stroke": "black",
        "strokeWidth": 0.3
      },
      "encoding": {
        "longitude": { "field": "lon", "type": "quantitative" },
        "latitude": { "field": "lat", "type": "quantitative" },
        "text": { "field": "label" },
        "color": { "value": "#000000" },
        "opacity": {
          "condition": { "test": "showLabels", "value": 1 },
          "value": 0
        }
      }
    }
  ]
}
