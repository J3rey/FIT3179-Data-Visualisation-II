{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "description": "Dynamic pie chart showing top 8 countries' attendance by year with year filter.",
  "width": 500,
  "height": 400,
  "data": {
    "url": "https://raw.githubusercontent.com/J3rey/FIT3179-Data-Visualisation-II/refs/heads/main/data/top8_countries_over_the_years.csv",
    "format": {
      "type": "csv",
      "parse": { "Year": "number", "Percentage_Attendance": "number" }
    }
  },
  "params": [
    {
      "name": "selectedYear",
      "value": 2024,
      "bind": {
        "input": "range",
        "min": 1964,
        "max": 2024,
        "step": 4
      }
    }
  ],
  "transform": [
    { "filter": "toNumber(datum.Year) === selectedYear" },
    {
      "calculate": "datum.country === 'Others' ? 'Other' : datum.country",
      "as": "country"
    },
    {
      "aggregate": [
        { "op": "sum", "field": "Percentage_Attendance", "as": "total" }
      ],
      "groupby": ["country"]
    },
    {
      "window": [{ "op": "rank", "as": "rank" }],
      "sort": [{ "field": "total", "order": "descending" }]
    },
    { "filter": "datum.rank <= 8" }
  ],
  "mark": { "type": "arc", "tooltip": true, "outerRadius": 160 },
  "encoding": {
    "theta": { "field": "total", "type": "quantitative" },
    "color": {
      "field": "country",
      "type": "nominal",
      "scale": {
        "domain": [
          "United States",
          "France",
          "Australia",
          "Germany",
          "Great Britain",
          "Italy",
          "Canada",
          "Spain",
          "Russia",
          "Soviet Union",
          "East Germany",
          "West Germany",
          "China",
          "Japan",
          "Brazil",
          "Netherlands",
          "Sweden",
          "Belgium",
          "Romania",
          "Cuba",
          "Bulgaria",
          "Hungary",
          "Mexico",
          "Unified Team",
          "Other"
        ],
        "range": [
          "#e41a1c",
          "#377eb8",
          "#4daf4a",
          "#984ea3",
          "#ff7f00",
          "#ffff33",
          "#a65628",
          "#f781bf",
          "#66c2a5",
          "#8da0cb",
          "#e78ac3",
          "#a6d854",
          "#ffd92f",
          "#e5c494",
          "#b3b3b3",
          "#8dd3c7",
          "#ffffb3",
          "#fb8072",
          "#1b9e77",
          "#d95f02",
          "#7570b3",
          "#fb9a99",
          "#fccde5",
          "#b15928",
          "#d9d9d9"
        ]
      },
      "legend": {
        "title": "Country/Team",
        "symbolLimit": 0
      }
    },
    "tooltip": [
      { "field": "country", "type": "nominal", "title": "Country" },
      {
        "field": "total",
        "type": "quantitative",
        "title": "Attendance (%)",
        "format": ".2f"
      }
    ]
  },
  "view": { "stroke": "transparent" }
}
