<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
      Which demographic group is currently the most prominent in the Olympics?
    </title>

    <!-- Vega, Vega-Lite, Vega-Embed -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <style>
      :root {
        --max-width: 1100px;
      }
      html,
      body {
        margin: 0;
        padding: 0;
        background: #ffffff;
        color: #111111;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, sans-serif;
        line-height: 1.45;
      }
      header {
        max-width: var(--max-width);
        margin: 24px auto 8px auto;
        padding: 0 16px;
        text-align: center;
      }
      header h1 {
        margin: 0 0 6px 0;
        font-size: clamp(20px, 3.5vw, 32px);
        font-weight: 700;
        letter-spacing: 0.3px;
      }
      header p {
        margin: 0 auto 6px auto;
        max-width: 820px;
        opacity: 0.85;
        font-size: 14px;
      }

      /* Poster layout, vertical scroll */
      .poster {
        max-width: var(--max-width);
        margin: 0 auto 48px auto;
        padding: 8px 16px 32px 16px;
        display: flex;
        flex-direction: column;
        gap: 28px;
      }

      /* Each section has a small title and a figure container */
      section.chart-block {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .chart-title {
        font-size: clamp(16px, 2.4vw, 20px);
        font-weight: 600;
        letter-spacing: 0.2px;
        margin: 0;
      }
      .chart-note {
        margin: 0;
        font-size: 13px;
        opacity: 0.7;
      }

      /* Chart host, prevents any cut off, allows x scroll if spec is wider */
      .vis {
        width: 100%;
        overflow-x: auto;
        overflow-y: visible;
        border: 1px solid #eee;
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        background: #fff;
      }

      /* Make embeds expand inside host, reduce blur on scaled canvas */
      .vega-embed,
      .vega-embed > canvas,
      .vega-embed > svg {
        display: block;
        max-width: none;
      }

      /* Small footer */
      footer {
        max-width: var(--max-width);
        margin: 16px auto 40px auto;
        padding: 0 16px;
        font-size: 12px;
        opacity: 0.65;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>
        Which demographic group is currently the most prominent in the Olympics?
      </h1>
    </header>

    <main class="poster">
      <!-- Containers for each chart -->
      <section class="chart-block">
        <h2 class="chart-title" id="title-butterfly">
          Athlete Age Distribution by Gender in Paris 2024 Summer Olympics
        </h2>
        <div class="vis" id="chart-butterfly"></div>
      </section>

      <section class="chart-block">
        <h2 class="chart-title" id="title-choropleth">
          Medals or Participation, by Country Map
        </h2>
        <p class="chart-note">
          If the spec has its own title, it will show in the graphic.
        </p>
        <div class="vis" id="chart-choropleth"></div>
      </section>

      <section class="chart-block">
        <h2 class="chart-title" id="title-stacked">
          Medal Distribution in Paris 2024 Summer Olympics
        </h2>
        <div class="vis" id="chart-stacked"></div>
      </section>

      <section class="chart-block">
        <h2 class="chart-title" id="title-pictorial">
          Athlete Gender Comparison in Paris 2024 Summer Olympics
        </h2>
        <div class="vis" id="chart-pictorial"></div>
      </section>

      <section class="chart-block">
        <h2 class="chart-title" id="title-pie">
          Top 8 Countries' Attendance Over Years in Olympics
        </h2>
        <div class="vis" id="chart-pie"></div>
      </section>
    </main>

    <footer>
      Built with Vega and Vega-Lite, charts are fully interactive with tooltips
      where defined in the specs.
    </footer>

    <script>
      // Minimal, crisp rendering
      const embedOpts = {
        renderer: "canvas",
        actions: false,
        tooltip: true,
      };

      const charts = [
        {
          el: "#chart-butterfly",
          file: "./js/butterfly_chart.json",
          titleEl: "#title-butterfly",
        },
        {
          el: "#chart-choropleth",
          file: "./js/chloropleth_map.json",
          titleEl: "#title-choropleth",
        },
        {
          el: "#chart-stacked",
          file: "./js/horizontal_stacked_bar_chart.json",
          titleEl: "#title-stacked",
        },
        {
          el: "#chart-pictorial",
          file: "./js/pictorial_chart.json",
          titleEl: "#title-pictorial",
        },
        {
          el: "#chart-pie",
          file: "./js/pie_chart_years.json",
          titleEl: "#title-pie",
        },
      ];

      // Make each spec responsive to its host width
      async function loadAndEmbed({ el, file, titleEl }) {
        const host = document.querySelector(el);
        try {
          const res = await fetch(file);
          let spec = await res.json();

          // Surface spec title if present
          try {
            const titleNode = document.querySelector(titleEl);
            if (spec && spec.title) {
              if (typeof spec.title === "string")
                titleNode.textContent = spec.title;
              else if (spec.title.text) titleNode.textContent = spec.title.text;
            }
          } catch {}

          const isVegaLite =
            typeof spec.$schema === "string" &&
            spec.$schema.includes("vega-lite");

          if (isVegaLite) {
            // Remove fixed width that causes squish
            if (typeof spec.width === "number") delete spec.width;
            // Let Vega-Lite size to container width
            spec.width = "container";

            // Give a sensible height if none set
            if (typeof spec.height !== "number") {
              // For maps a bit taller feels better
              spec.height = 520;
            }

            // Extra safety for map specs that use projections
            if (spec.projection && !spec.config) spec.config = {};
            if (spec.projection) {
              // Helps Vega-Lite fit the map to the view box
              spec.projection.fit = spec.projection.fit ?? true;
            }

            // Improve defaults for responsive sizing
            spec.config = Object.assign(
              {
                view: {
                  continuousWidth: host.clientWidth,
                  continuousHeight: spec.height || 520,
                },
              },
              spec.config || {}
            );
          } else {
            // Vega spec
            // Remove hard width, set autosize to fit the host
            if (typeof spec.width === "number") delete spec.width;
            spec.autosize = Object.assign(
              { type: "fit", contains: "padding", resize: true },
              spec.autosize || {}
            );
            // Set initial size to host width
            spec.width = host.clientWidth;
            if (typeof spec.height !== "number") spec.height = 520;
          }

          // First render
          const view = await vegaEmbed(el, spec, embedOpts);

          // Keep it fitting on window resize
          const ro = new ResizeObserver(() => {
            try {
              const w = host.clientWidth;
              if (isVegaLite) {
                view.view.width(w).runAsync();
              } else {
                view.view.width(w).runAsync();
              }
            } catch {}
          });
          ro.observe(host);
        } catch (e) {
          host.innerHTML =
            "<p style='margin:0;padding:6px;font-size:14px;color:#b00020;'>Could not load " +
            file +
            "</p>";
          console.error("Embed error for", file, e);
        }
      }

      charts.forEach(loadAndEmbed);
    </script>
  </body>
</html>
